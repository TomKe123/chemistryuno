# 初始化设置向导功能

## 功能说明

新增了部署后的初始化设置向导，首次访问时会自动引导用户设置管理员密码。

## 工作流程

1. **首次访问检测**
   - 访问 `http://localhost:3000` 时，系统会检查 `.env` 文件中是否已配置 `REACT_APP_ADMIN`
   - 如果未配置或值为默认值 `your_admin_password_here`，自动跳转到 `/setup` 页面

2. **设置管理员密码**
   - 用户在设置向导页面输入管理员密码（至少6位）
   - 确认密码后点击"完成设置"

3. **保存配置**
   - 密码会被写入项目根目录的 `.env` 文件
   - 如果 `.env` 不存在，会从 `.env.example` 复制并更新密码
   - 保存成功后显示成功页面

4. **自动跳转**
   - 3秒后自动跳转到 `/admin` 管理面板
   - 可以立即使用新设置的密码登录

## 新增文件

### 前端文件

1. **client/src/components/Setup.js**
   - 设置向导主组件
   - 包含密码输入表单和验证逻辑
   - 成功后显示动画效果

2. **client/src/components/Setup.css**
   - 设置向导页面样式
   - 响应式设计，支持移动端
   - 渐变背景和动画效果

### API 端点

1. **GET /api/setup/check**
   - 检查是否已完成初始化设置
   - 返回：`{ isSetup: boolean }`

2. **POST /api/setup**
   - 保存管理员密码到 .env 文件
   - 请求体：`{ adminPassword: string }`
   - 返回：`{ success: boolean, message: string }`

## 代码修改

### client/src/App.js
- 添加 `Setup` 组件导入
- 添加设置状态检测逻辑
- 添加 `/setup` 路由处理
- 首次访问时检查是否需要设置

### client/src/config/api.js
- 添加 `checkSetup` API 端点
- 添加 `setup` API 端点

### server/index.js
- 添加 `/api/setup/check` 路由
- 添加 `/api/setup` 路由
- 实现 .env 文件读写逻辑

## 使用方法

### 首次部署

1. 部署应用后，访问 `http://localhost:3000`
2. 系统自动跳转到设置向导
3. 设置管理员密码（建议8位以上，包含字母和数字）
4. 点击"完成设置"
5. 等待跳转到管理面板

### 后续访问

- 设置完成后，再次访问 `http://localhost:3000` 直接进入游戏大厅
- 访问 `/admin` 使用设置的密码登录管理面板

## 安全说明

1. **密码要求**
   - 最短6位（建议8位以上）
   - 支持字母、数字和特殊字符
   - 需要确认密码以防止输入错误

2. **密码存储**
   - 密码存储在 `.env` 文件中
   - 不会提交到 Git 仓库（.gitignore 已配置）
   - 部署到生产环境时请确保文件权限正确

3. **修改密码**
   - 可以直接编辑 `.env` 文件修改 `REACT_APP_ADMIN` 的值
   - 修改后需要重启服务器才能生效
   - 将来可以在管理面板中添加修改密码功能

## 注意事项

1. **环境变量生效**
   - 密码保存后，前端环境变量需要重新构建才能完全生效
   - 当前实现会在保存后跳转到管理面板，可以直接使用
   - 如果遇到问题，请重启前端开发服务器

2. **.env 文件**
   - 确保项目根目录有 `.env.example` 文件作为模板
   - 如果两者都不存在，会自动创建包含默认配置的 .env 文件

3. **生产环境**
   - Docker 部署时，需要确保容器有权限写入 .env 文件
   - 建议使用 Docker volumes 挂载 .env 文件
   - 或者在容器启动前通过环境变量注入

## 界面预览

### 设置向导页面
- 紫色渐变背景
- 居中白色卡片
- 密码输入框（带确认）
- 安全提示信息
- 完成设置按钮

### 成功页面
- 绿色圆形勾选图标
- "设置完成！"提示
- "正在跳转到管理面板..."
- 加载动画

## 技术细节

- React Hooks (useState, useEffect)
- Axios HTTP 请求
- Node.js fs 文件系统操作
- CSS3 动画和渐变
- 响应式设计（支持移动端）

---

**更新日期**: 2026-01-03  
**版本**: v1.1.0
