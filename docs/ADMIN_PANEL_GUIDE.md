# 🔧 化学UNO - 管理面板指南

本指南介绍如何使用管理面板来自定义游戏配置和化学反应规则。

## 📋 目录

- [管理面板概述](#管理面板概述)
- [访问管理面板](#访问管理面板)
- [配置结构](#配置结构)
- [管理元素](#管理元素)
- [管理物质](#管理物质)
- [管理反应](#管理反应)
- [保存和应用](#保存和应用)
- [常见场景](#常见场景)
- [注意事项](#注意事项)

## 🎯 管理面板概述

管理面板允许你：
- ✅ 添加、修改、删除化学反应规则
- ✅ 管理游戏中的元素和物质
- ✅ 自定义游戏配置
- ✅ 实时生效，无需重启服务器

## 🔐 访问管理面板

### 1. 打开管理面板

访问地址：
```
http://localhost:3000/admin
```

或移动端：
```
http://[电脑IP]:3000/admin
```

### 2. 登录验证

管理面板需要密码保护。

**设置管理员密码**：

编辑项目根目录的 `.env` 文件（如果不存在则创建）：

```bash
# .env
REACT_APP_ADMIN_PASSWORD=your-secure-password
```

> ⚠️ **安全提示**：
> - 使用强密码（建议12位以上，包含数字、字母、符号）
> - 不要将密码提交到代码仓库
> - `.env` 文件应该在 `.gitignore` 中

**重启应用**：
```bash
pnpm start
```

### 3. 输入密码

在登录页面输入你设置的管理员密码，点击"登录"。

## 📊 配置结构

配置文件 `config.json` 包含三个主要部分：

```json
{
  "elements": [
    {
      "symbol": "H",
      "name": "氢",
      "count": 12
    }
  ],
  "compounds": [
    {
      "formula": "H2O",
      "name": "水"
    }
  ],
  "reactions": [
    {
      "reactants": ["HCl", "NaOH"],
      "products": ["NaCl", "H2O"],
      "description": "酸碱中和反应"
    }
  ]
}
```

### 元素配置

```typescript
interface Element {
  symbol: string      // 元素符号（如"H"、"O"）
  name: string        // 元素名称（如"氢"、"氧"）
  count: number       // 牌组中的数量
}
```

### 物质配置

```typescript
interface Compound {
  formula: string     // 化学式（如"H2O"）
  name: string        // 物质名称（如"水"）
}
```

### 反应配置

```typescript
interface Reaction {
  reactants: string[]    // 反应物（化学式数组）
  products: string[]     // 生成物（化学式数组）
  description?: string   // 反应描述（可选）
}
```

## 🧪 管理元素

### 查看元素列表

管理面板会显示所有已配置的元素，包括：
- 元素符号
- 元素名称
- 牌组数量

### 添加元素

1. 在"元素管理"部分点击"添加元素"
2. 填写信息：
   - **符号**：元素符号（1-2个字符）
   - **名称**：元素中文名称
   - **数量**：在牌组中的数量

**示例**：
```
符号: Fe
名称: 铁
数量: 4
```

### 修改元素

1. 找到要修改的元素
2. 点击"编辑"按钮
3. 修改相关信息
4. 点击"保存"

### 删除元素

1. 找到要删除的元素
2. 点击"删除"按钮
3. 确认删除

> ⚠️ **注意**：删除元素会影响使用该元素的所有物质和反应

## 🔬 管理物质

### 查看物质列表

显示所有已配置的化合物：
- 化学式
- 中文名称
- 组成元素

### 添加物质

1. 在"物质管理"部分点击"添加物质"
2. 填写信息：
   - **化学式**：标准化学式（如"H2SO4"）
   - **名称**：物质中文名称

**示例**：
```
化学式: H2SO4
名称: 硫酸
```

**化学式格式要求**：
- 元素符号首字母大写
- 数字表示原子个数
- 括号表示原子团：`Ca(OH)2`
- 特殊符号：
  - `↑` 表示气体
  - `↓` 表示沉淀

### 修改物质

类似元素的修改流程。

### 删除物质

> ⚠️ **注意**：删除物质会影响包含该物质的所有反应

## ⚗️ 管理反应

### 查看反应列表

显示所有化学反应规则：
- 反应物
- 生成物
- 反应描述

### 添加反应

这是管理面板最重要的功能！

**步骤**：

1. 点击"添加反应"
2. 添加反应物：
   - 点击"添加反应物"
   - 输入化学式（如"AgNO3"）
   - 可添加多个反应物
3. 添加生成物：
   - 点击"添加生成物"
   - 输入化学式（如"AgCl"）
   - 可添加多个生成物
4. 填写描述（可选）：
   - 描述反应类型或特点
5. 点击"保存反应"

**示例1：沉淀反应**
```
反应物: AgNO3, NaCl
生成物: AgCl↓, NaNO3
描述: 银离子与氯离子生成氯化银沉淀
```

**示例2：酸碱中和**
```
反应物: HCl, NaOH
生成物: NaCl, H2O
描述: 强酸强碱中和反应
```

**示例3：置换反应**
```
反应物: CuSO4, Fe
生成物: FeSO4, Cu
描述: 铁置换铜
```

### 双向反应

系统会自动处理双向反应。例如：

添加反应：`A + B → C + D`

系统自动识别以下情况为可反应：
- A + B（按添加的顺序）
- B + A（反向顺序）

如果化学反应是可逆的，需要分别添加两个反应。

### 修改反应

1. 找到要修改的反应
2. 点击"编辑"
3. 修改反应物或生成物
4. 保存更改

### 删除反应

1. 找到要删除的反应
2. 点击"删除"
3. 确认删除

## 💾 保存和应用

### 保存配置

1. 完成所有修改后
2. 点击页面底部的"保存配置"按钮
3. 配置会立即保存到 `config.json`
4. 服务器自动重新加载配置

### 配置验证

保存前系统会验证：
- ✅ 化学式格式是否正确
- ✅ 引用的元素是否存在
- ✅ 反应物和生成物是否有效
- ✅ 必填字段是否完整

### 实时生效

- 保存后**立即生效**
- 正在进行的游戏**不受影响**
- 新创建的游戏使用新配置

### 备份配置

**建议在修改前备份**：

```bash
# 备份配置文件
cp config.json config.json.backup

# 恢复备份
cp config.json.backup config.json
```

## 🎯 常见场景

### 场景1：添加新的反应规则

**需求**：添加硫酸铜和氢氧化钠的反应

**步骤**：
1. 确保物质存在：
   - 检查是否有 `CuSO4` 和 `NaOH`
   - 如果没有，先添加物质
2. 添加反应：
   ```
   反应物: CuSO4, NaOH
   生成物: Cu(OH)2↓, Na2SO4
   描述: 生成氢氧化铜沉淀
   ```
3. 保存配置

### 场景2：扩展元素库

**需求**：添加稀有元素

**步骤**：
1. 添加元素：
   ```
   符号: Pt  名称: 铂  数量: 2
   符号: Hg  名称: 汞  数量: 2
   ```
2. 添加相关物质：
   ```
   化学式: PtCl4  名称: 四氯化铂
   化学式: HgO    名称: 氧化汞
   ```
3. 添加反应规则
4. 保存配置

### 场景3：平衡游戏难度

**需求**：减少某些元素的数量

**步骤**：
1. 找到常见元素（如H、O）
2. 修改数量（例如从12改为8）
3. 保存配置

### 场景4：主题自定义

**需求**：创建"有机化学"主题

**步骤**：
1. 添加有机元素和物质：
   ```
   元素: C, H, O, N
   物质: CH4, C2H5OH, CH3COOH, C6H12O6
   ```
2. 添加有机反应：
   ```
   C2H5OH + O2 → CH3COOH + H2O（乙醇氧化）
   ```
3. 保存配置

## ⚠️ 注意事项

### 化学式格式

**正确格式**：
```
H2O           ✅
Ca(OH)2       ✅
Fe2O3         ✅
CuSO4·5H2O    ✅
AgCl↓         ✅
H2↑           ✅
```

**错误格式**：
```
h2o           ❌ (小写)
H2o           ❌ (O应该大写)
Ca(oh)2       ❌ (OH中的O应该大写)
```

### 反应规则

1. **反应物和生成物必须都存在于物质库中**
2. **不考虑化学计量数**（系数）
   - 正确：`H2, O2 → H2O`
   - 不需要：`2H2, O2 → 2H2O`
3. **反应的方向性**
   - 系统会自动处理 A+B 和 B+A
   - 可逆反应需要添加两个反应规则

### 数据一致性

- **删除元素前**，确保没有物质使用该元素
- **删除物质前**，确保没有反应使用该物质
- **修改化学式时**，相关反应会失效

### 性能考虑

- 过多的元素（>50）会影响加载速度
- 过多的反应规则（>1000）会影响反应检测速度
- 建议保持合理的数据量

### 安全性

- 定期更换管理员密码
- 不要在公共网络上使用管理面板
- 重要修改前做好备份

## 🔍 调试技巧

### 检查配置是否生效

```bash
# 查看配置文件
cat config.json

# 测试API
curl http://localhost:5000/api/config
```

### 验证反应规则

在游戏中测试：
1. 创建测试游戏
2. 尝试打出相关物质
3. 检查是否能成功反应

### 查看服务器日志

```bash
# 查看控制台输出
# 会显示配置加载信息和反应检测结果
```

## 📚 配置示例

### 完整配置示例

```json
{
  "elements": [
    {"symbol": "H", "name": "氢", "count": 12},
    {"symbol": "O", "name": "氧", "count": 12},
    {"symbol": "Na", "name": "钠", "count": 4},
    {"symbol": "Cl", "name": "氯", "count": 4}
  ],
  "compounds": [
    {"formula": "H2O", "name": "水"},
    {"formula": "NaCl", "name": "氯化钠"},
    {"formula": "NaOH", "name": "氢氧化钠"},
    {"formula": "HCl", "name": "盐酸"},
    {"formula": "Na2O", "name": "氧化钠"}
  ],
  "reactions": [
    {
      "reactants": ["HCl", "NaOH"],
      "products": ["NaCl", "H2O"],
      "description": "酸碱中和"
    },
    {
      "reactants": ["Na2O", "H2O"],
      "products": ["NaOH"],
      "description": "氧化钠溶于水"
    }
  ]
}
```

## 📖 相关文档

- [开发者指南](DEVELOPER_GUIDE.md) - 配置文件结构详解
- [快速开始](GETTING_STARTED.md) - 游戏基础
- [项目总结](PROJECT_SUMMARY.md) - 技术架构

## 💡 最佳实践

1. **渐进式修改**：一次修改一小部分，测试后再继续
2. **保持备份**：重要修改前先备份配置
3. **文档化**：在 `description` 字段记录反应特点
4. **测试验证**：修改后在游戏中实际测试
5. **版本控制**：使用Git管理配置文件变更

---

[← 返回文档中心](README.md)
