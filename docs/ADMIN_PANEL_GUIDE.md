# 管理面板反应规则修改指南

## 问题说明

用户反馈"管理面板无法修改可反应的物质"。经过测试，后端API功能正常，问题可能是用户操作流程不清晰。

## 解决方案

### 1. 后端验证（已完成）✅

测试结果表明API完全正常：
```bash
node test_admin_reactions.js
```

输出：
- ✓ 配置获取成功
- ✓ 配置保存成功
- ✓ 新反应已成功保存
- ✓ 原配置已恢复

### 2. 前端改进（已完成）✅

#### 改进内容：

1. **添加调试日志**
   - 在 `updateReactionPartners` 中添加控制台输出
   - 在 `addReactant` 中添加控制台输出
   - 在 `handleSave` 中添加详细的保存日志

2. **改进UI反馈**
   - 添加黄色警告框，提醒用户有未保存的更改
   - 改进textarea的focus样式
   - 添加hover效果增强交互感

3. **添加删除确认**
   - 删除反应前弹出确认对话框
   - 防止误操作

## 使用方法

### 访问管理面板

1. 启动服务器：
   ```bash
   npm run dev
   ```

2. 在浏览器访问：
   ```
   http://localhost:3000/admin
   ```

3. 输入管理员密码（在 `.env` 中配置的 `REACT_APP_ADMIN`）

### 修改反应规则

#### 方法1：修改现有反应

1. 在"反应规则"区域找到要修改的反应物（如 `HCl`）
2. 在对应的文本框中编辑可反应物质列表
   - 每行一个物质
   - 例如：
     ```
     NaOH
     Ca(OH)2
     Mg
     KMnO4
     ```
3. **重要**：点击页面顶部的"保存配置"按钮
4. 看到"配置已保存 ✓"提示即成功

#### 方法2：添加新反应

1. 滚动到"反应规则"区域底部
2. 在"反应物"输入框输入反应物名称（如 `TestCompound`）
3. 在下方的文本框输入可反应物质列表（每行一个）
4. 点击"添加反应物"按钮
5. **重要**：点击页面顶部的"保存配置"按钮
6. 看到"配置已保存 ✓"提示即成功

#### 方法3：删除反应

1. 找到要删除的反应物
2. 点击该反应块下的"删除"按钮
3. 在弹出的确认对话框中点击"确定"
4. **重要**：点击页面顶部的"保存配置"按钮
5. 看到"配置已保存 ✓"提示即成功

### 常见问题

#### Q1: 修改了但没有生效？

**A**: 请确保点击了页面顶部的"保存配置"按钮。所有修改都是暂存在浏览器内存中，只有点击保存后才会写入配置文件。

#### Q2: 如何确认是否有未保存的更改？

**A**: 查看以下指示：
- 顶部状态栏显示"待保存"（黄色）表示有未保存更改
- "保存配置"按钮处于可点击状态
- 反应规则区域会显示黄色警告框

#### Q3: 不小心改错了怎么办？

**A**: 在保存前，点击"重置更改"按钮可以撤销所有未保存的修改。

#### Q4: 如何验证修改是否生效？

**A**: 保存后，可以：
1. 点击"重新加载"按钮，查看配置是否正确
2. 查看控制台日志（F12打开开发者工具）
3. 在游戏中测试相应的反应

### 调试信息

打开浏览器控制台（F12 -> Console标签），可以看到以下日志：

- `📝 更新反应: HCl -> [NaOH, Ca(OH)2, Mg]` - 表示正在修改反应
- `✓ 反应已更新到草稿，需点击"保存配置"按钮` - 提醒需要保存
- `💾 开始保存配置...` - 开始保存
- `✅ 配置保存成功` - 保存完成

### 配置文件位置

修改会保存到项目根目录的 `config.json` 文件中的 `representative_reactions` 字段。

示例格式：
```json
{
  "representative_reactions": {
    "HCl": ["NaOH", "Ca(OH)2", "Mg", "KMnO4"],
    "NaOH": ["HCl", "H2SO4", "CuSO4"],
    "H2SO4": ["NaOH", "Mg(OH)2"]
  }
}
```

## 测试脚本

项目包含以下测试脚本：

1. `test_admin_reactions.js` - 测试API保存功能
2. `check_reactions.js` - 检查配置文件结构

运行测试：
```bash
node test_admin_reactions.js
node check_reactions.js
```

## 总结

管理面板的反应修改功能完全正常，关键是要记得：

⚠️ **修改后必须点击"保存配置"按钮！**

所有改进已实施，包括：
- ✅ 调试日志输出
- ✅ 明显的视觉提示
- ✅ 删除确认对话框
- ✅ 改进的交互反馈
