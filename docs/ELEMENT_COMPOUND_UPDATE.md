# 单张元素卡打出功能更新说明

## 功能描述

当玩家打出单张元素卡时，系统会显示所有可用的物质选项，包括：

1. **对应的单质**（如果存在）
2. **包含该元素的所有化合物**

## 实现细节

### 1. 服务器端更新 (`server/database.js`)

#### 新增方法：`getElementToSimpleSubstance()`
- 建立元素到单质的映射关系
- 支持的单质包括：
  - 双原子分子：H2, O2, N2, Cl2, F2, Br2, I2
  - 特殊单质：P4, S8, C
  - 金属单质：Fe, Cu, Zn, Al, Mg, Ca, Na, K, Ag, Mn, Si

#### 更新方法：`getCompoundsByElements()`
- 当传入单个元素时，优先添加对应的单质
- 然后添加所有包含该元素的化合物
- 避免重复添加

### 2. 客户端更新 (`client/src/components/GameBoard.js`)

- 移除了客户端侧添加元素卡本身的逻辑
- 直接使用服务器返回的完整物质列表
- 改进了错误处理，失败时显示空列表而不是元素本身

### 3. 物质选择器 (`client/src/components/CompoundSelector.js`)

- 无需修改，自动支持新的物质列表
- 包含搜索功能，方便用户快速找到目标物质

## 测试结果

创建了完整的测试套件 (`test_element_compounds.js`)，验证了以下元素：

| 元素 | 单质 | 可用物质数量 | 示例化合物 |
|------|------|-------------|-----------|
| H (氢) | H2 | 27 | H2O, HCl, H2SO4, NaOH |
| O (氧) | O2 | 71 | H2O, CO2, SO2, CaO |
| Cl (氯) | Cl2 | 21 | HCl, NaCl, CaCl2 |
| Na (钠) | Na | 11 | NaOH, NaCl, Na2SO4 |
| Fe (铁) | Fe | 13 | FeO, Fe2O3, FeCl2 |
| C (碳) | C | 11 | CO, CO2, CaCO3 |
| N (氮) | N2 | 22 | NO, NO2, NH3 |

所有测试均通过 ✓

## 使用示例

### 场景1：打出氢元素卡(H)

1. 玩家点击手中的 H 卡
2. 系统显示物质选择器，包含27个选项：
   - **H2** (单质) ← 排在第一位
   - H2O (水)
   - HCl (盐酸)
   - H2SO4 (硫酸)
   - NaOH (氢氧化钠)
   - ... 等23个含氢化合物

### 场景2：打出氯元素卡(Cl)

1. 玩家点击手中的 Cl 卡
2. 系统显示物质选择器，包含21个选项：
   - **Cl2** (氯气单质) ← 排在第一位
   - HCl (盐酸)
   - NaCl (氯化钠)
   - CaCl2 (氯化钙)
   - ... 等17个含氯化合物

### 场景3：打出金属钠卡(Na)

1. 玩家点击手中的 Na 卡
2. 系统显示物质选择器，包含11个选项：
   - **Na** (金属钠单质) ← 排在第一位
   - NaOH (氢氧化钠)
   - NaCl (氯化钠)
   - Na2SO4 (硫酸钠)
   - ... 等7个含钠化合物

## 技术优势

1. **清晰的逻辑**：单质作为元素的直接对应物，优先显示
2. **完整的选择**：包含所有包含该元素的化合物
3. **易于扩展**：通过 `getElementToSimpleSubstance()` 方法可轻松添加新的元素-单质映射
4. **性能优化**：避免重复添加，使用Set去重

## 相关文件

- `server/database.js` - 服务器端数据库逻辑
- `client/src/components/GameBoard.js` - 游戏板组件
- `client/src/components/CompoundSelector.js` - 物质选择器组件
- `test_element_compounds.js` - 测试脚本

## 后续优化建议

1. 可考虑在物质选择器中为单质添加特殊标记（如图标或背景色）
2. 可以按照物质类别分组显示（单质、氧化物、酸、碱、盐等）
3. 可以根据玩家手牌自动过滤掉无法合成的化合物（缺少必需元素）
